var OP={};OP.version=429;OP.callbacks={};OP.events={};OP.is=parent!==window;OP.pending=[];OP.$appearance=0;OP.interval=setInterval(function(){if(OP.ready){clearInterval(OP.interval);OP.pending.forEach(OP.$process);OP.pending=[]}},500);OP.jcomponent=function(e){var r='';var a='';var i='';function s(){r=NAV.query.openplatform;a=NAV.query.rev;i=NAV.query.language}s();ON('request',function(e){if(!r)s();var n=e.url.indexOf('?');var o=n===-1?e.url:e.url.substring(0,n);o=o.substring(o.indexOf('/',9)+1);var t=o.substring(o.length-10);n=t.indexOf('.');if(n===-1)e.headers.Authorization='base64 '+btoa(r+','+a+','+i)});ON('@flag showloading',function(){OP.loading(true)});ON('@flag hideloading',function(){OP.loading(false,1e3)});OP.onready=function(e){if(e.dateformat){DEF.dateformat=e.dateformat;if(W.user){user.timeformat=e.timeformat;user.dateformat=e.dateformat;user.numberformat=e.numberformat;DEF.languagehtml=user.language}switch(e.numberformat){case 1:DEF.decimalseparator='.';DEF.thousandsseparator=' ';break;case 2:DEF.decimalseparator=',';DEF.thousandsseparator=' ';break;case 3:DEF.decimalseparator=',';DEF.thousandsseparator='.';break;case 4:DEF.decimalseparator='.';DEF.thousandsseparator=',';break}var n=(DEF.timeformat===12?'!':'')+(DEF.dateformat+' - HH:mm')+(DEF.timeformat===12?' a':'');ENV('date',DEF.dateformat);ENV('ts',n)}OP.$appearance=1;OP.send('appearance');EMIT('opready');SET('common.ready',true,500)};OP.init(e)};document.addEventListener('click',function(e){var n=e.target;var o=n;if(o.tagName!=='A'){var t=3;while(--t>=0){o=o.parentNode;if(!o||o.tagName==='BODY'||o.tagName==='HTML')break;if(o.tagName==='A'){n=o;break}}}if(n.tagName==='A'){if(n.href.substring(0,15)==='openplatform://'){var r=n.href.substring(15);var t=r.indexOf('?');var a=t===-1?'':r.substring(t+1);if(t!==-1)r=r.substring(0,t);e.preventDefault();if(a){var i=a.split('&');a={};for(var s=0;s<i.length;s++){var c=i[s].split('=');if(c[0])a[c[0]]=c[1]&&decodeURIComponent(c[1])}}OP.share(r,'link',a);return false}}OP&&OP.$sendfocus()});document.onkeydown=function(e){var n=false;if(e.keyCode===112){n=true;OP.send('quicksearch')}else if(e.keyCode===116){OP.loading(false);OP.offline(false);OP.progress(0);setTimeout(function(){if(location.href.indexOf('openplatform=')===-1)location.href=OP.tokenizator(location.href);else location.reload(true)},200);n=true}else if(e.keyCode===9&&(e.altKey||e.ctrlKey||e.metaKey)){n=true;OP.send('nextwindow')}if(n){e.returnValue=false;e.keyCode=0;return false}};OP.changelog=function(e){OP.send('changelog',{body:e})};OP.help=function(e){OP.send('help',{body:e})};OP.success2=function(e,n,o){OP.console('success',e,n,o)};OP.titlesuccess=function(e){OP.send('titlesuccess',e)};OP.install=function(e){OP.send('install',{type:'install',url:e})};OP.titlewarning=function(e){if(e instanceof Array)e=e[0].error;OP.send('titlewarning',e)};OP.warning2=function(e,n,o){OP.console('warning',e,n,o)};OP.error2=function(e,n,o){OP.console('error',e,n,o)};OP.info2=function(e,n,o){OP.console('info',e,n,o)};OP.busy=function(e){OP.send('busy',e)};OP.appearance=function(){OP.$appearance=1;OP.send('appearance')};OP.console=function(e,n,o,t){if(n instanceof Array){for(var r=0;r<n.length;r++){var a=n[r];if(a&&a.error)a=a.error;a&&OP.send('console',{type:e,msg:(t||'')+a,show:o})}}else OP.send('console',{type:e,msg:(t||'')+n,show:o})};OP.command=function(e,n){OP.send('command',{type:e,body:n})};OP.screenshot=function(e,n){if(!OP.$screenshot){var o;if(!window.Promise){o=document.createElement('script');o.type='text/javascript';o.src=(e||'//cdnjs.cloudflare.com/ajax/libs/babel-polyfill/6.26.0')+'/polyfill.min.js';document.body.appendChild(o)}o=document.createElement('script');o.type='text/javascript';o.src=(e||'//html2canvas.hertzen.com/dist')+'/html2canvas.min.js';document.body.appendChild(o);OP.$screenshot=1}var t=function(){OP.loading(true);html2canvas(document.body).then(function(e){if(n)n(e.toDataURL('image/jpeg',.85));else OP.send('screenshot',e.toDataURL('image/jpeg',.85));OP.loading(false)})};var r=setInterval(function(){if(window.html2canvas){clearInterval(r);t()}},1e3)};OP.launched=function(e){OP.send('launched',null,e)};OP.progress=function(e){return OP.send('progress',e)};OP.init=function(t,n){if(typeof t==='boolean'){embeded=t;t=null}OP.ready=false;if(n)OP.is=true;OP.embeded=!n;if(!t){t=function(e){if(e==null){OP.ready=true;return}if(document.body)document.body.innerHTML='401: Unauthorized';else throw new Error('401: Unauthorized');setTimeout(function(){window.close()},2e3)}}if(!OP.is){t(new Error('OpenPlatform isn\'t detected.'));document.body.innerHTML='401: Unauthorized';return}var e=location.search.substring(1).split('&');var o=null;for(var r=0;r<e.length;r++){var a=e[r];if(a.substring(0,13)==='openplatform='){var i=decodeURIComponent(a.substring(13));OP.token=a.substring(13);o=decodeURIComponent(i.substring(i.indexOf('token=')+6));break}}var s={};s.ua=navigator.userAgent;OP.accesstoken=o;document.addEventListener('DOMContentLoaded',function(){if(n){OP.ready=true;var e=window.user||{};t&&setTimeout(t,100,null,e);OP.onready&&OP.onready({});OP.$process({type:'appearance',body:{colorscheme:e.colorscheme,darkmode:e.darkmode}});window.addEventListener('resize',function(){OP.emit('resize')});OP.emit('ready');return}var o=setTimeout(function(){o=null;t('timeout');document.body.innerHTML='401: Unauthorized'},2e3);OP.send('verify',s,function(e,n){if(o){clearTimeout(o);OP.ready=!e;t(null,n,setTimeout(function(){n.href&&(location.href=n.href)},100))}o=null;OP.id=n.id;OP.openplatformurl=n.openplatformurl;OP.onready&&OP.onready(n);OP.emit('ready')})})};OP.$sendfocus=function(){var e=Date.now();if(!OP.$focus||OP.$focus<e)OP.focus();OP.$focus=e+1e3*2};document.addEventListener('touchstart',function(){OP&&OP.$sendfocus()},{passive:true});OP.loading2=function(e,n){OP.$loading2&&clearTimeout(OP.$loading2);if(!n){OP.send('loading2',e);return}OP.$loading2=setTimeout(function(e){OP.send('loading2',e)},n,e)};OP.loading=function(e,n){OP.$loading&&clearTimeout(OP.$loading);var o={show:e,text:''};if(typeof n==='string'){o.text=n;n=0}if(!n){OP.send('loading',o);return}OP.$loading=setTimeout(function(e){OP.send('loading',e)},n,o)};OP.success=function(e,n){return OP.snackbar(e,'success',n)};OP.warning=function(e,n){return OP.snackbar(e,'warning',n)};OP.message=function(e,n,o){var t={};t.body=e;t.type=n;t.button=o;return OP.send('message',t)};OP.confirm2=function(e,n,o){OP.confirm(e,n instanceof Array?n:n.split(',').trim(),function(e){!e&&o()})};OP.approve=function(e,n,o){OP.confirm(e,[n],o)};OP.confirm=function(e,n,o){var t={};t.body=e;t.buttons=n instanceof Array?n:n.split(',').trim();var r=window.M&&window.M.scope?window.M.scope():null;return OP.send('confirm',t,function(e,n){r&&window.M.scope(r);o(n?n.index:-1)})};OP.options=function(n,t){OP.on('options',function(){var e=[];n(e);var o=window.M&&window.M.scope?window.M.scope():null;OP.send('options',e,function(e,n){o&&window.M.scope(o);n&&t(n)})})};OP.config=function(e,o){var n={};if(typeof e==='function'){o=e;n.body=null}else n.body=JSON.stringify(e);var t=window.M&&window.M.scope?window.M.scope():null;return OP.send('config',n,function(e,n){t&&window.M.scope(t);o&&o(n,e)})};OP.clipboard=function(e){OP.send('clipboard',e)};OP.snackbar=function(e,n,o){var t={};t.body=e;t.type=n;t.button=o;return OP.send('snackbar',t,o)};OP.offline=function(e){OP.send('offline',e)};OP.meta=function(o){var e={};e.ua=navigator.userAgent;e.accesstoken=OP.accesstoken;var t=window.M&&window.M.scope?window.M.scope():null;OP.send('meta',e,function(e,n){t&&window.M.scope(t);o(e,n)})};OP.play=function(e){if(!/^[a-z]+$/.test(e)&&!/^(http|https):\/\//.test(e)){if(e.substring(0,1)!=='/')e='/'+e;e=location.protocol+'//'+location.hostname+e}return OP.send('play',e)};OP.stop=function(e){return OP.send('stop',e)};OP.focus=function(){return OP.send('focus')};OP.maximize=function(e){return OP.send('maximize',e)};OP.restart=function(){return OP.send('restart',location.href)};OP.open=function(e,n){return OP.send('open',{id:e,data:n})};OP.minimize=function(){return OP.send('minimize')};OP.badge=function(e){return OP.send('badge',e)};OP.log=function(e){return OP.send('log',e)};OP.close=function(){return OP.send('kill')};OP.notify=function(e,n,o){if(typeof e==='string'){o=n;n=e;e=0}return OP.send('notify',{type:e,body:n,data:o||'',dtcreated:new Date})};OP.share=function(e,n,o,t){setTimeout(function(){OP.send('share',{app:e&&typeof e==='object'?e.id:e,type:n,body:o,dtcreated:new Date,silent:t})},100);return OP};OP.report=function(e,n,o){return OP.send('report',{type:e,body:n,high:o})};OP.mail=function(e,n,o,t){return OP.send('mail',{email:e,subject:n,body:o,dtcreated:new Date,type:t||'html'})};OP.shake=function(e){return OP.send('shake',e)};OP.send=function(e,n,o){if(typeof n==='function'){o=n;n=null}var t={};t.openplatform=true;t.accesstoken=OP.accesstoken;t.type=e;t.body=n||null;t.sender=true;t.origin=location.origin;if(!top){o&&o(new Error('The application is not running in the OpenPlatform scope.'));return}if(o){t.callback=(Math.random()*1e6).toString(32).replace(/\./g,'');OP.callbacks[t.callback]=o}parent.postMessage(JSON.stringify(t),'*');return OP};OP.on=function(e,n){if(e==='print'||e==='options')OP.events[e]=null;!OP.events[e]&&(OP.events[e]=[]);OP.events[e].push(n);return OP};OP.on('print',function(){window.print()});OP.$process=function(e){if(e.callback){var n=OP.callbacks[e.callback];if(n){if(e.sender)e.error=new Error('The application is not running in the OpenPlatform scope.');n(e.error,e.body||{});delete OP.callbacks[e.callback]}return}if(e.sender)return;if(e.type==='link'){var o=OP.events[e.type];if(o){for(var t=0;t<o.length;t++)o[t](e.body.path,e.body.data)}return}if(e.type==='command'){var o=OP.events[e.type];if(o){for(var t=0;t<o.length;t++)o[t](e.body.type,e.body.body)}return}if(e.type==='focus'){window.focus();return}if(e.type==='appearance'&&OP.$appearance){var r=document.head||document.getElementsByTagName('head')[0];var a=document.createElement('style');var i;if(OP.$appearance===1){OP.$appearance=2}else{i=document.getElementById('opstyle');i&&i.parentNode.removeChild(i)}var s=e.body||e;var c=document.body.classList;if(OP.darkmode!==false){c.add(s.darkmode?'opdark':'oplight');s.darkmode&&c.add('ui-dark');c.add('opbody');c.remove(s.darkmode?'oplight':'opdark');!s.darkmode&&c.remove('ui-dark');window.OPDARKMODE=s.darkmode}if(s.color)s.colorscheme=s.color;if(!s.colorscheme)s.colorscheme='#4285f4';window.OPCOLOR=s.colorscheme;a.appendChild(document.createTextNode(':root{--opcolor:'+s.colorscheme+';--color:'+s.colorscheme+'}.opbody{background-color:#'+(s.darkmode?'202020':'FFF')+'}body.opbody{color:#'+(s.darkmode?'E0E0E0':'000')+'}.opborder,.opborderhover:hover{border-color:'+s.colorscheme+'!important}.opbg,.opbghover:hover{background-color:'+s.colorscheme+'!important}.opfg,.opfghover:hover{color:'+s.colorscheme+'!important}'));a.id='opstyle';r.appendChild(a)}if(e.type==='reload'){if(location.href.indexOf('openplatform=')===-1)location.href=OP.tokenizator(location.href);else location.reload(true);return}if(e.type==='screenshotmake'){OP.screenshot(e.body);return}if(e.type==='redirect'){location.href=e.body;return}if(e.type==='kill')e.type='close';if(e.type==='share'){e.body.share=function(e,n){OP.share(this.app,e,n)}}var o=OP.events[e.type];if(o){var s={};for(var t=0;t<o.length;t++)o[t](e.body||s)}};OP.emit=function(e,n,o,t,r,a){var i=OP.events[e];if(i&&i.length){for(var s=0;s<i.length;s++)i[s](n,o,t,r,a)}else{if(e==='help'||e==='changelog')OP.send(e,null)}};OP.done=function(o,t,r){if(typeof o==='function'){r=t;t=o;o=null}if(r==null)r=true;var a=window.M&&window.M.scope?window.M.scope():null;return function(e,n){r&&OP.loading(false,500);a&&window.M.scope(a);if(!e&&n)e=[{name:'network',error:n}];if(e instanceof Array){OP.send('done',e)}else{o&&OP.send('done',o);t&&t(e,n)}}};OP.resume=function(o,t){var r=window.M&&window.M.scope?window.M.scope():null;return function(e,n){r&&window.M.scope(r);t&&OP.loading(false,500);if(!e&&n)e=[{name:'network',error:n}];if(e instanceof Array){OP.send('done',e)}else{if(typeof o==='function')o(e);else SETR(o,e)}}};window.addEventListener('message',function(e){try{var n=JSON.parse(e.data);if(!n.openplatform)return;if(n.TYPE)n.type=n.TYPE;if(!OP.ready&&n.type!=='verify')OP.pending.push(n);else OP.$process(n)}catch(e){}},false);OP.link=function(e,n){var o='OPLINKINPUT';var t=window[o];if(!t){t=document.createElement('INPUT');t.style='position:absolute;left:-100px;top:-100px;opacity:0';document.body.appendChild(t);window[o]=t}var n=JSON.stringify({id:OP.id,path:e,data:n});n=n.substring(1,n.length-1);var r=OP.openplatformurl+'?share='+btoa(encodeURIComponent(n)).replace(/=/g,'');setTimeout(function(){t.value=r;t.focus();t.select();document.execCommand('copy')},100);return r};OP.tokenizator=function(e){var n=e.indexOf('?');return n===-1?e+('?openplatform='+OP.token):e.substring(0,n+1)+('openplatform='+OP.token+'&'+e.substring(n+1))};if(window.history){history.pushState(null,null,location.href);window.onpopstate=function(){history.go(1)}}